graphApp.controller("SearchCtrl",["$scope","$element","GraphData",function($scope,$element,GraphData){function cancel(e){e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation&&(e.stopPropagation(),e.preventDefault())}var maxResults=6,bloodhound=new Bloodhound({limit:maxResults,local:GraphData.nodes(),datumTokenizer:function(d){return Bloodhound.tokenizers.whitespace(d.title)},queryTokenizer:Bloodhound.tokenizers.whitespace});bloodhound.initialize().done(function(){$scope.ready=!0}),$scope.$on("keypress",function(scope,e){(47==e.which||(e.metaKey||e.ctrlKey)&&102==e.which)&&(cancel(e),$element.find("input").focus())}),$scope.matches=[],$scope.$watch("searchQuery",function(query){$scope.ready&&bloodhound.get(query,function(suggestions){$scope.matches=suggestions,$scope.selectedResult=0})}),GraphData.on("select.node",function(){$scope.matches=[],$element.find("input").blur()}),$scope.clear=function(timeout){setTimeout(function(){$scope.matches=[],$scope.searchQuery=""},timeout||0)},$scope.goTo=function(id){$scope.clear(),GraphData.emit("select.node",id)},$scope.searchKey=function(e){if(40==e.which||0==e.which)e.preventDefault(),e.stopPropagation(),$scope.selectedResult=Math.min($scope.selectedResult+1,$scope.matches.length-1);else if(38==e.which)e.preventDefault(),e.stopPropagation(),$scope.selectedResult=Math.max(0,$scope.selectedResult-1);else if(13==e.which&&$scope.selectedResult>-1){e.preventDefault(),e.stopPropagation();var id=$scope.matches[$scope.selectedResult].id;$scope.goTo(id)}}}]);