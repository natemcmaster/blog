graphApp.controller("GraphCtrl",["$scope","$http","$element","GraphData",function(){function t(t,n){this.a=t,this.b=n}function n(t){var n=m-x;return n/(t.radius+1)+x}function r(t){return Math.cos(t.angle)*t.radius*b}function e(t){return Math.sin(t.angle)*t.radius*b}function a(t){var n=Math.PI/2;return t>3*n||t<n}function i(t){return t/Math.PI*180}function o(t){var r=(Math.PI/2,d3.select(this)),e=a(t.angle);if(0!=t.level)r.text(t.title).attr("y",0).attr("text-anchor",e?"start":"end").attr("transform",e?"translate("+(10+n(t))+")":"rotate(180)translate(-"+(10+n(t))+")");else{var i=t.title.split(" ");r.text("").attr("y",n).attr("transform","translate(0)rotate(0)").attr("text-anchor","middle");for(var o=0;o<i.length;o++){var c=i[o];i[o+1]&&i[o+1].length<=3&&(c+=" "+i[o+1],o++);var l=r.append("tspan").text(c);l.attr("x",0).attr("dy",M(t.radius))}}}function c(t){for(var n=2*Math.PI/t.count[2],r=0,e=t.items.children.length-1;e>=0;e--){for(var a=t.items.children[e],i=a.children.length,o=0;o<i;o++){var c=a.children[o];c.radius=2,c.angle=r,r+=n}if(i%2===0){var l=i/2,s=l-1;a.angle=(a.children[s].angle+a.children[l].angle)/2}else a.angle=a.children[(i-1)/2].angle;a.radius=1}return t.items.angle=0,t.items.radius=0,t.items}function l(n){function r(n){e.push(n),n.children.forEach(function(e){e.empty||(a.push(new t(n,e)),r(e))})}var e=[],a=[];r(n),s(a),u(e)}function s(t){var n=f.select("#lines").selectAll(".link").data(t,function(t){return t.a.id>t.b.id?1e3*t.a.id+t.b.id:t.a.id+1e3*t.b.id});n.enter().append("line").attr("class","link").attr("x1",function(t){var n=t.a.parent||t.a;return r(n)}).attr("y1",function(t){var n=t.a.parent||t.a;return e(n)}).attr("x2",function(t){var n=t.a.parent||t.a;return r(n)}).attr("y2",function(t){var n=t.a.parent||t.a;return e(n)}).transition().duration(y).attr("x2",function(t){return r(t.b)}).attr("y2",function(t){return e(t.b)}),n.transition().duration(y).attr("x1",function(t){return r(t.a)}).attr("y1",function(t){return e(t.a)}).attr("x2",function(t){return r(t.b)}).attr("y2",function(t){return e(t.b)}),n.exit().remove()}function u(t){var r=f.select("#nodes").selectAll(".item").data(t,function(t){return t.id}),e=r.enter().append("g").on("click",p).attr("class",function(t){return"item level-"+t.radius}).attr("transform",function(t){var n=t.parent||t;return"rotate("+i(n.angle)+")translate("+n.radius*b+")"});e.transition().duration(y).attr("transform",function(t){return"rotate("+i(t.angle)+")translate("+t.radius*b+")"}),e.append("text").attr("class","node-label").each(o),e.append("circle").attr("r",n).attr("cx",0).attr("cy",0).attr("class","node");var a=r.attr("class",function(t){return"item level-"+t.radius}).transition().duration(y).attr("transform",function(t){return"rotate("+i(t.angle)+")translate("+t.radius*b+")"});a.select("circle").attr("r",n),a.select("text").each(o),r.exit().remove()}function d(t,n,r,e){h=e,f=d3.select(r[0]).append("svg").attr("viewBox",[0,0,v,g].join(" ")).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform","translate("+v/2+","+g/2+")"),f.append("g").attr("id","lines"),f.append("g").attr("id","nodes"),h.on("select.node",function(t,n){this.centerOnNode(n)}.bind(this)),p=function(t){this.selectNode(t.id)}.bind(this)}var f,h,p,v=500,g=500,m=14,x=5,y=1300,b=100,M=function(t){return 15-2*t};return d.prototype.selectNode=function(t){h.emit("select.node",t)},d.prototype.centerOnNode=function(t){for(var n=h.tree(t),r=n.items.children.length-1;r>=0;r--){var e=n.items.children[r];e.children.length||(n.count[2]++,e.children=[{empty:!0}])}var a=c(n);l(a)},d}()]);