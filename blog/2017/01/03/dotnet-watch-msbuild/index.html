<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>.NET Core command-line file watcher (dotnet watch) for MSBuild</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Infrequent blog posts about software development, lifehacks, opinion, etc.
">
    <meta name="generator" content="Jekyll">
    <meta name="author" content="Nate McMaster" comment="Surprised?">
    <meta http-equiv="Content-Language" content="en">
    <link rel="canonical" href="http://www.natemcmaster.com/blog/2017/01/03/dotnet-watch-msbuild/">
    <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro|Roboto+Slab:400,300|Open+Sans:300italic,400italic,600italic,400,600,300" rel="stylesheet" type="text/css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src="/assets/ga-d1faeb94eb25224ec0843d6c613d8cde7f294fd1d5bddd72fd16bbf8cccfe517.js"></script>
    <script type="text/javascript">
        (function (ga) {
            ga('send', 'pageview');
        })(ga);
    </script>
    <link type="text/css" rel="stylesheet" href="/assets/app-80ad1bdf6f437ed16def341f2041cd1fcf25680fdaa7d8fe343f9605178c2c5f.css">
</head>


    <body>

    <header class="site-header">

  <div class="wrap">

    <nav class="site-nav">
      <a href="#" class="menu-icon" analytics-on="click" analytics-event="menu_button">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" xml:space="preserve">
          <path fill="white" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="white" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="white" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
          <a class="page-link " href="/blog/">
          Blog
          </a>
        
        
          <a class="page-link " href="/projects/">
          Projects
          </a>
        
        
          
        
          <a class="page-link " href="/profile/">
          About Me
          </a>
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>
    <div class="brand">
      <div class="brand-img">
        <a href="/">
          <img src="//www.gravatar.com/avatar/692c58f37a3704944bd31c4cbcb287e7.png?s=150" class="img-profile"></a>
      </div>
      <div class="brand-name">
        <a class="site-title" href="/">Nate McMaster</a>
      </div>
    </div>
  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <header class="post-header">
  <p class="meta">Blog Post: January 3, 2017</p>
  <h1>.NET Core command-line file watcher (dotnet watch) for MSBuild</h1>
  
    <h2>Basic usage and pro-tips for using dotnet-watch with MSBuild</h2>
  
</header>

<article class="post-content">
  
    <p class="postimage hero ">
      
      
      <img src="/assets/blog/dotnet-watch-preview-8c6bb24f7370b88793e9714ba60b6632ff07f02227c040fee6e3fb1e45c4e221.png" alt=""/>
      
      
    </p>
  
<p>The most recent preview (<a href="https://www.nuget.org/packages/Microsoft.DotNet.Watcher.Tools/1.0.0-msbuild2-final">1.0.0-msbuild2-final</a>)
of <code class="highlighter-rouge">dotnet-watch</code> supports MSBuild projects, and is the most configurable, extensible version of the tool, yet.
<code class="highlighter-rouge">dotnet-watch</code> is a file watcher for <code class="highlighter-rouge">dotnet</code> that restarts the specified application when changes in the source code are detected.
This tool has been available since the days of DNX with support for <em>project.json</em>.
<code class="highlighter-rouge">dotnet-watch</code> for MSBuild adds new features that were not available in the <em>project.json</em> versions.</p>

<p>See also: <a href="https://github.com/aspnet/DotNetTools/">https://github.com/aspnet/DotNetTools/</a> for more documentation and to report issues.</p>

<h1 id="basic-usage">Basic usage</h1>

<h2 id="how-to-install">How To Install</h2>

<h3 id="visual-studio-2017-rc">Visual Studio 2017 RC</h3>

<p><em>Note: soon, the NuGet GUI will be able to install this package, but is broken in the most recent RC.</em></p>

<ol>
  <li>Open your .NET Core project in VS 2017 RC.</li>
  <li>Right click on the project in <em>Solution Explorer</em>.</li>
  <li>Select “Edit (YourProject).csproj”.</li>
  <li>Continue with next section</li>
</ol>

<h3 id="visual-studio-code-or-command-line-users">Visual Studio Code or command-line users</h3>

<p>Add <code class="highlighter-rouge">Microsoft.DotNet.Watcher.Tools</code> as a <code class="highlighter-rouge">DotNetCliToolReference</code> to your project by adding this to the csproj file.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;DotNetCliToolReference</span> <span class="na">Include=</span><span class="s">"Microsoft.DotNet.Watcher.Tools"</span> <span class="na">Version=</span><span class="s">"1.0.0-msbuild2-final"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre>
</div>

<h3 id="how-to-use">How To Use</h3>

<p>On command line, change directories (<code class="highlighter-rouge">cd C:\dev\MyApp</code>) into the directory containing your project. Then execute <code class="highlighter-rouge">dotnet watch</code>. 
This will show detailed help information and some examples.</p>

<p>To make dotnet-watch do something, add <code class="highlighter-rouge">watch</code> between <code class="highlighter-rouge">dotnet</code> and the command arguments that you want to execute.</p>

<p>For example, if you want to repeatedly run tests, execute <code class="highlighter-rouge">dotnet watch test</code>. Or, if you want to recompile and launch
your website when a C# file changes, run <code class="highlighter-rouge">dotnet watch run</code>. All <code class="highlighter-rouge">dotnet blah</code> verbs are supported. (In theory, you could 
even run <code class="highlighter-rouge">dotnet watch watch watch run</code>….but I don’t recommend it.)</p>

<h1 id="whats-new">What’s new</h1>

<p>dotnet-watch can be configured with settings in the MSBuild project file being watched.</p>

<h2 id="customize-which-files-are-watched">Customize which files are watched</h2>

<p>By default, dotnet-watch will track all <code class="highlighter-rouge">**/*.cs</code>, <code class="highlighter-rouge">*.csproj</code>, and <code class="highlighter-rouge">**/*.resx</code> files for changes. 
Well, kinda. The truth is a little more technical: the default is actually everything in the <strong>Compile</strong> and <strong>EmbeddedResource</strong> item groups,
plus any file added to the <strong>MSBuildProjectFiles</strong> list….but for most projects, this means all C# files.</p>

<p>More items can be added to the watchlist by editing the csproj file. Items can be added individually, or by using glob patterns.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;ItemGroup&gt;</span>
    <span class="c">&lt;!-- extends watching group to include *.js files --&gt;</span>
    <span class="nt">&lt;Watch</span> <span class="na">Include=</span><span class="s">"**\*.js"</span> <span class="na">Exclude=</span><span class="s">"node_modules\**\*;**\*.js.map;obj\**\*;bin\**\*"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre>
</div>

<h2 id="opt-out-of-defaults">Opt-out of defaults</h2>

<p>dotnet-watch can be configured to ignore its default settings. To ignore specific
files, add the <code class="highlighter-rouge">Watch="false"</code> attribute an item’s definition in the csproj file.</p>

<p>Example:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;ItemGroup&gt;</span>
    <span class="c">&lt;!-- exclude Generated.cs from dotnet-watch --&gt;</span>
    <span class="nt">&lt;Compile</span> <span class="na">Include=</span><span class="s">"Generated.cs"</span> <span class="na">Watch=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- exclude Strings.resx from dotnet-watch --&gt;</span>
    <span class="nt">&lt;EmbeddedResource</span> <span class="na">Include=</span><span class="s">"Strings.resx"</span> <span class="na">Watch=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- exclude changes in this referenced project --&gt;</span>
    <span class="nt">&lt;ProjectReference</span> <span class="na">Include=</span><span class="s">"..\ClassLibrary1\ClassLibrary1.csproj"</span> <span class="na">Watch=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre>
</div>

<h1 id="for-msbuild-ninjas">For MSBuild ninjas</h1>

<h2 id="the-watch-build">The ‘watch’ build</h2>

<p>When dotnet-watch reads a *.csproj to find which files it should watch,
it actually executes the MSBuild project. It calls a target named <code class="highlighter-rouge">GenerateWatchList</code> 
in the project. When this target runs, dotnet-watch will set the property <code class="highlighter-rouge">DotNetWatchBuild=true</code>.
This is similar to how Visual Studio and VS Code execute the csproj with <code class="highlighter-rouge">DesignTimeBuild=true</code>
to discover files, NuGet references, etc.</p>

<h2 id="custom-watch-projects">Custom ‘watch projects’</h2>

<p>dotnet-watch is not restricted to C# projects. You can create custom ‘watch’ projects to do your bidding.</p>

<h3 id="example-watch-multiple-test-projects">Example: watch multiple test projects</h3>

<p>Example: let’s say you have the following project layout:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>test/
    UnitTests/UnitTests.csproj
    IntegrationTests/IntegrationTests.csproj
</code></pre>
</div>

<p>If you wanted to watch multiple projects, and execute tests on all, you create file like this
in <code class="highlighter-rouge">test/watch.proj</code>:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;Project</span> <span class="na">ToolsVersion=</span><span class="s">"15.0"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;ItemGroup&gt;</span>
        <span class="nt">&lt;TestProjects</span> <span class="na">Include=</span><span class="s">"**\*.csproj"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;Watch</span> <span class="na">Include=</span><span class="s">"**\*.cs"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/ItemGroup&gt;</span>

    <span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">"Test"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;MSBuild</span> <span class="na">Targets=</span><span class="s">"VSTest"</span> <span class="na">Projects=</span><span class="s">"@(TestProjects)"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/Target&gt;</span>

    <span class="nt">&lt;ItemGroup&gt;</span>
        <span class="nt">&lt;DotNetCliToolReference</span> <span class="na">Include=</span><span class="s">"Microsoft.DotNet.Watcher.Tools"</span> <span class="na">Version=</span><span class="s">"1.0.0-msbuild3-final"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/ItemGroup&gt;</span>

    <span class="nt">&lt;Import</span> <span class="na">Project=</span><span class="s">"$(MSBuildExtensionsPath)\Microsoft.Common.targets"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/Project&gt;</span>
</code></pre>
</div>

<p>Then execute</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd test\
dotnet restore watch.proj
dotnet watch msbuild /t:Test
</code></pre>
</div>

<p>This will watch all test projects, and execute VSTest when any file changes.</p>

</article>
<div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'nmblog8'; // required: replace example with your forum shortname
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

  <div class="vcard">
    <h4 class="fn">Nate McMaster</h4>
  </div>

    <div class="footer-col-1 column">
      <div>
        <a href="mailto:" analytics-on="click" analytics-event="email" rel=""></a>
      </div>
      <div class="footer-icons">
          
            <a href="https://github.com/natemcmaster" analytics-on="click" analytics-event="outbound" analytics-label="github_profile">
              <span class="icon-github"></span>
            </a>
          
            <a href="https://twitter.com/natemcmaster" analytics-on="click" analytics-event="outbound" analytics-label="twitter_profile">
              <span class="icon-twitter"></span>
            </a>
          
           <a href="https://www.linkedin.com/in/natemcmaster" analytics-on="click" analytics-event="outbound" analytics-label="linkedin_profile">
            <span class="icon-linkedin"></span>
            </a>
          
      </div>
    </div>


    <div class="footer-col-3 column">
      <p class="text">Infrequent blog posts about software development, lifehacks, opinion, etc.
Disclaimer: Thoughts and opinions are my own.</p>
    </div>

  </div>

</footer>


    </body>
</html>
